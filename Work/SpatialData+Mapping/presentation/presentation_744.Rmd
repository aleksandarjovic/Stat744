---
title: "presentation"
author: "The Alex(k)'s"
date: "3/14/2018"
output: html_document
---

#Spatial Data

##Overview

advantages and disadvantages of contour vs fill plot
spatial mapping - theory
density plots

which choice will you make about bin size or type of bin shape.

also show the points for density plots (points versus density plots)


#Leaflet

```{r setup}
library(leaflet)
```

`addTiles()` gives the default base map in leaflet

```{r}
m <- leaflet() %>% 
  addTiles()
m
```

##Base Maps

`addProviderTiles()` gives you a tile layer from a known map provider

```{r}
m %>% addProviderTiles(providers$Stamen.Toner) 
```

```{r}
m %>% addProviderTiles(providers$CartoDB.Positron)
```

```{r}
m %>% addProviderTiles(providers$Esri.NatGeoWorldMap)
```


```{r}
#install.packages("kableExtra")
#devtools::install_github("haozhu233/kableExtra")

library(kableExtra)
library(knitr)

text_tbl <- data.frame(
  BaseMap = c("Default", "Stamen.Tower", "CartoDB.Positron", "Esri.NatGeoWorldMap"),
  Pros = c("Zoomed out - colours are fairly simple", "None?", "Great for added colour as the background colour is mutual", "Shows different landscapes of Earth, i.e. deepness of water & dry/wet regions"),
  Cons = c("Zoom in - gives extra colour", "Any colour added to plot will likely be hard to see", "None?", "Specific uses only")
)

kable(text_tbl, "html") %>%
  kable_styling(full_width = T) 
```


###Example: Base Map versus CartoDB.Positron Map (Weather Systems)

`addWMSTiles` is for adding Web Map Service tiles

```{r}
leaflet() %>% addTiles() %>%
  addWMSTiles(
    "http://mesonet.agron.iastate.edu/cgi-bin/wms/nexrad/n0r.cgi",
    layers = "nexrad-n0r-900913",
    options = WMSTileOptions(format = "image/png", transparent = TRUE),
    attribution = "Weather data © 2012 IEM Nexrad"
  )
```

```{r}
leaflet() %>% addProviderTiles(providers$CartoDB.Positron) %>%
  addWMSTiles(
    "http://mesonet.agron.iastate.edu/cgi-bin/wms/nexrad/n0r.cgi",
    layers = "nexrad-n0r-900913",
    options = WMSTileOptions(format = "image/png", transparent = TRUE),
    attribution = "Weather data © 2012 IEM Nexrad"
  )
```

##Circle Markers

```{r}
data(quakes)

leaflet(data = quakes) %>%  addProviderTiles(providers$CartoDB.Positron) %>%
  addCircleMarkers(~long, ~lat, radius = ~sqrt(exp(mag))/2, label = ~as.character(mag), color = "black", fillColor = "red", fillOpacity = 0.1, stroke = FALSE, opacity = 0)

leaflet(data = quakes) %>%  addProviderTiles(providers$CartoDB.Positron) %>%
  addCircleMarkers(~long, ~lat, radius = ~sqrt(exp(mag))/2, label = ~as.character(mag), color = "black", fillColor = "red", fillOpacity = 0.6, stroke = FALSE, opacity = 0)
```

**Comments about the plot above:**

* when you zoom in, there is more detail shown
* option to make the fillOpacity small so the patterns can be more distinguishable
* problem: can't distinguish between different magnitudes (which are represented in the size)
* question: how should I scale the magnitude (as magnitude is in a log scale) and what colour should I represent to show earthquakes?
* next step: find a way to represent plate boundaries to create another layer over this map.

##Read OGR (OpenGIS Simple Features Reference Implementation)

```{r}
library(rgdal)
states <- readOGR("shapefiles/cb_2016_us_state_20m.shp",
 layer = "cb_2016_us_state_20m", GDAL1_integer64_policy = TRUE)

leaflet(states) %>%
    addPolygons(color = "#444444", weight = 2, smoothFactor = 0.5,
                opacity = 0.1, fillOpacity = 0.8,
                fillColor = ~colorQuantile("YlOrRd", ALAND)(ALAND),
                highlightOptions = highlightOptions(color = "white", weight = 2,
                                                    bringToFront = TRUE))

leaflet(states) %>% addProviderTiles(providers$CartoDB.Positron) %>%
    addPolygons(color = "#444444", weight = 2, smoothFactor = 0.5,
                opacity = 0.1, fillOpacity = 0.8,
                fillColor = ~colorQuantile("YlOrRd", ALAND)(ALAND),
                highlightOptions = highlightOptions(color = "white", weight = 2,
                                                    bringToFront = TRUE))
```

**Comment about the plot above:**

* question: when should one include `\addProviderTiles()`? 


```{r}
library(geojsonio)

states <- geojsonio::geojson_read("geojson/us-states.json", what = "sp")

m <- leaflet(states) %>%
  addProviderTiles("MapBox", options = providerTileOptions(
    id = "mapbox.light",
    accessToken = Sys.getenv('MAPBOX_ACCESS_TOKEN')))

m %>% addPolygons()
```



